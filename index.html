<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TANKS GAME</title>
<style>
#canvas{
    border:red 2px solid;

}


</style>


</head>

<body>
    <canvas id="canvas" width="900" height="600">

    </canvas>

    <script>
        document.addEventListener("keydown",onKeyDown,);
        const canvas = document.querySelector("#canvas");
        const ctx = canvas.getContext("2d");


        const player = document.querySelector('#player');

        let step = 15;

        var position = {x:0,y:0};
        var greenArray = [];
        prepareMap();
        gameLoop();
        //let moveInterval = setInterval(move,100);

        function prepareMap(){
            for(var i=0;i < 30; i++){
                var min = 0;
                var max = canvas.width;
                var positionX = Math.floor(Math.random() * canvas.width/30) * 30;
                var positionY = Math.floor(Math.random() * canvas.width/30) * 30;
                // console.log(positionX,positionY);
                greenArray.push([positionX,positionY]);
            }
        }

        function gameLoop(){
            ctx.clearRect(0, 0, canvas.width, canvas.height); // czyszczenie
            // console.log("przyszłe pozycje:", position.x+step*2, position.y+step*2,"borders:", canvas.width,canvas.height);
            // budowanie mapy
            ctx.fillStyle = "red"; // kolor
            for(var i=0;i < 30;i++){
            // ctx.fillRect(greenArray[i[0]],greenArray[i[1]],step*2,step*2);
            ctx.fillRect(greenArray[i][0],greenArray[i][1],step*2,step*2);
            // console.log(greenArray[i]); //box mapa
            }
            // rysowanie gracza
            ctx.fillStyle = "grey"; // kolor
            ctx.fillRect(position.x,position.y,step*2,step*2); // czołg
            // ssconsole.log(position.x,position.y);
        }
        function onKeyDown(event){
            console.log(event.which, event.code);
            switch(event.code){

                case "KeyA":
                    let checkerA = false;

                    if( position.x - step < 0){
                        checkerA = true;
                    }  
                        
                        for(var i=0;i < greenArray.length;i++) {
                            if(greenArray[i][0] === position.x - step*2){
                                if(greenArray[i][1] === position.y || greenArray[i][1] === position.y - step || greenArray[i][1] === position.y + step){
                                    checkerA = true;
                                }
                            }
                        } 
                    
                    if(checkerA === false) {
                        position.x -= step;
                        gameLoop(); 
                    } 
                break;
                
                case "KeyD":
                    let checkerD = false;

                    if( position.x + step * 3 > canvas.width){
                        checkerD = true;
                    }    

                    for(var i=0;i < greenArray.length;i++) {
                        if(greenArray[i][0] === position.x + step*2){
                            if(greenArray[i][1] === position.y || greenArray[i][1] === position.y - step || greenArray[i][1] === position.y + step){
                                checkerD = true;
                            }
                        }
                    }
                    if(checkerD === false) {
                        position.x += step;
                        gameLoop(); 
                    }   
                break;
                
                case "KeyW":
                    let checkerW = false;

                    if( position.y - step < 0 ){
                        checkerW = true;
                    }    
                    for(var i=0;i < greenArray.length;i++) {
                        if(greenArray[i][1] === position.y - step*2){
                            if(greenArray[i][0] === position.x || greenArray[i][0] === position.x - step || greenArray[i][0] === position.x + step){
                                checkerW = true;
                            }
                        }
                    }                        
                    if(checkerW === false) {
                        position.y -= step;
                        gameLoop(); 
                    }       
                break;

                // case "KeyS":
                //     console.log("w dół");
                //     if(position.y < canvas.width - step*2){
                //     position.y+= step;
                //     gameLoop();
                //     console.log(position.x,position.y);
                //     }
                // break;

                case "KeyS":
                    let checkerS = false;

                    
                    if( position.y + step * 3 > canvas.height){
                        checkerS = true;
                    }  

                    for(var i=0;i < greenArray.length;i++) {
                        if(greenArray[i][1] === position.y + step*2){
                            if(greenArray[i][0] === position.x || greenArray[i][0] === position.x - step || greenArray[i][0] === position.x +step){
                                checkerS = true;
                            }
                        }
                    }
                    if(checkerS === false) {
                        position.y += step;
                        gameLoop(); 
                    }   
                break;

                case "Space":
                    
                break;
            }
        }

    </script>
</body>
</html>
